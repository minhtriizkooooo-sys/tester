<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√¢n T√≠ch ƒêi·ªÉm B·∫•t Th∆∞·ªùng</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            background-color: #f0f2f6;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .main { 
            background-color: #f0f2f6; 
        }
        button, input[type="submit"] { 
            background-color: #4CAF50; 
            color: white; 
            border-radius: 5px; 
            padding: 8px 16px;
            border: none;
            cursor: pointer;
        }
        button:hover, input[type="submit"]:hover {
            background-color: #45a049;
        }
        input[type="file"]::file-selector-button {
            font-weight: bold;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            padding: 5px 10px;
            border: none;
        }
        select[multiple] {
            width: 100%;
            padding: 5px;
            border-radius: 5px;
            min-height: 100px;
        }
        .container {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        h1 { 
            color: #2c3e50; 
        }
        h2 { 
            color: #34495e; 
        }
        .alert {
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
        }
        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        footer { 
            visibility: hidden; 
        }
        .footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 10px;
        }
        .footer p {
            margin: 5px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .sidebar {
            width: 250px;
            float: left;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-right: 20px;
        }
        .content {
            margin-left: 270px;
        }
        .logo img {
            width: 100px;
        }
        .row {
            display: flex;
            align-items: center;
        }
        .row .logo {
            flex: 1;
        }
        .row .title {
            flex: 6;
        }
    </style>
</head>
<body>
    <div class="main">
        <div class="row">
            <div class="logo">
                {% if logo_error %}
                    <p>üè´ THPT Marie Curie</p>
                {% else %}
                    <img src="/static/Logo_Marie_Curie.png" alt="Logo" width="100">
                {% endif %}
            </div>
            <div class="title">
                <h1>üìä Ph√¢n T√≠ch ƒêi·ªÉm S·ªë B·∫•t Th∆∞·ªùng S·ª≠ D·ª•ng Z-Score</h1>
            </div>
        </div>
        <p>
            ·ª®ng d·ª•ng ph√¢n t√≠ch ƒëi·ªÉm s·ªë b·∫•t th∆∞·ªùng d·ª±a tr√™n Z-score.<br>
            - File CSV c·∫ßn c√≥ header: "MaHS", "Lop", c√°c c·ªôt m√¥n h·ªçc.<br>
            - Z-score: ƒêi·ªÉm b·∫•t th∆∞·ªùng n·∫øu |z-score| > ng∆∞·ª°ng (m·∫∑c ƒë·ªãnh 2).<br>
            - H·ªó tr·ª£ UTF-8.
        </p>

        <div class="sidebar">
            <h2>üõ† C√†i ƒë·∫∑t</h2>
            <form method="post" enctype="multipart/form-data" action="/">
                <label for="file">üìÇ Upload b·∫£ng ƒëi·ªÉm (CSV):</label><br>
                <input type="file" id="file" name="file" accept=".csv" required><br><br>
                <label for="z_threshold">Ng∆∞·ª°ng Z-Score:</label><br>
                <input type="number" id="z_threshold" name="z_threshold" min="1.0" max="5.0" step="0.1" value="2.0"><br><br>
                {% if class_options %}
                    <label for="classes">Ch·ªçn l·ªõp ƒë·ªÉ l·ªçc:</label><br>
                    <select id="classes" name="classes" multiple>
                        {% for cls in class_options %}
                            <option value="{{ cls }}" selected>{{ cls }}</option>
                        {% endfor %}
                    </select><br><br>
                {% endif %}
                {% if subject_options %}
                    <label for="subjects">Ch·ªçn m√¥n ƒë·ªÉ ph√¢n t√≠ch:</label><br>
                    <select id="subjects" name="subjects" multiple>
                        {% for subj in subject_options %}
                            <option value="{{ subj }}" selected>{{ subj }}</option>
                        {% endfor %}
                    </select><br><br>
                {% endif %}
                <p>CSV ph·∫£i c√≥ c·ªôt s·ªë cho ƒëi·ªÉm v√† m√£ h√≥a UTF-8.</p>
                <input type="submit" value="Ph√¢n t√≠ch">
            </form>
        </div>

        <div class="content">
            {% if error %}
                <div class="alert alert-error">{{ error }}</div>
            {% endif %}
            {% if warning %}
                <div class="alert alert-warning">{{ warning }}</div>
            {% endif %}
            {% if classes %}
                <h2>üìã B·∫£ng ƒëi·ªÉm g·ªëc v√† b·∫•t th∆∞·ªùng</h2>
                <div style="display: flex;">
                    <div style="flex: 3;">
                        <h3>B·∫£ng g·ªëc h·ªçc sinh</h3>
                        {{ original_table|safe }}
                        <h3>H·ªçc sinh b·∫•t th∆∞·ªùng</h3>
                        {{ anomaly_table|safe }}
                        {% if csv_data %}
                            <form method="post" action="/download">
                                <input type="hidden" name="csv_data" value="{{ csv_data }}">
                                <input type="submit" value="üì• Xu·∫•t CSV h·ªçc sinh b·∫•t th∆∞·ªùng">
                            </form>
                        {% endif %}
                    </div>
                </div>

                <h2>üìä Bi·ªÉu ƒë·ªì c·ªôt theo l·ªõp</h2>
                <div id="bar-chart"></div>
                <script>
                    {{ bar_chart|safe }}
                </script>

                <h2>üìà Scatter & Histogram theo m√¥n</h2>
                {% for subject, scatter, hist in charts %}
                    <h3>{{ subject }}</h3>
                    <div id="scatter-{{ subject }}"></div>
                    <script>
                        {{ scatter|safe }}
                    </script>
                    <div id="hist-{{ subject }}"></div>
                    <script>
                        {{ hist|safe }}
                    </script>
                {% endfor %}
            {% endif %}
        </div>
    </div>

    <div class="footer">
        <p><b>Nh√≥m Th·ª±c Hi·ªán:</b> L·∫°i Nguy·ªÖn Minh Tr√≠ v√† nh·ªØng ng∆∞·ªùi b·∫°n</p>
        <p>üìû Li√™n h·ªá: 0908-083566 | üìß Email: laingminhtri@gmail.com</p>
        <p>¬© 2025 Tr∆∞·ªùng THPT Marie Curie - D·ª± √°n Ph√¢n T√≠ch ƒêi·ªÉm B·∫•t Th∆∞·ªùng</p>
    </div>
</body>
</html>
